from spike import PrimeHub, LightMatrix, Button, StatusLight, ForceSensor, MotionSensor, Speaker, ColorSensor, App, DistanceSensor, Motor, MotorPair
from spike.control import wait_for_seconds, wait_until, Timer
from math import *

hub = PrimeHub()
timer = Timer()

colorLeft = ColorSensor('B')
colorRight = ColorSensor('D')
tank = MotorPair('A','C')

Kp = 0.8
Ki = 0
Kd = 0.2
last_error = 0
error = 0
basic_speed = 20

count = 0
timer.reset()
while timer.now() < 10:
    try:
        error = colorLeft.get_reflected_light() - colorRight.get_reflected_light()
    except:
        print('cant get ref')
    u = Kp * error + Ki * (error + last_error) + Kd * (error - last_error)
    tank.start_tank(int(basic_speed + u),int(basic_speed - u))
    count += 1

tank.stop()
print(count)
